{{define "settings/panel/bugreport"}}
<a-card :bordered="false" :style="{ marginBottom: '16px' }">
  <a-alert v-if="!bugReportServiceAvailable" type="warning" :style="{ marginBottom: '16px' }" show-icon>
    <template slot="message">
      {{ i18n "pages.settings.bugReport.serviceUnavailable" }}
    </template>
    <template slot="description">
      {{ i18n "pages.settings.bugReport.serviceUnavailableDesc" }}
    </template>
  </a-alert>
  <a-alert v-else type="info" :style="{ marginBottom: '16px' }" show-icon>
    <template slot="message">
      {{ i18n "pages.settings.bugReport.info" }}
    </template>
    <template slot="description">
      {{ i18n "pages.settings.bugReport.infoDesc" }}
    </template>
  </a-alert>

  <a-form @submit="handleSubmitBugReport">
    <a-form-item label='{{ i18n "pages.settings.bugReport.titleLabel" }}' :required="true">
      <a-input
        v-model.trim="bugReportData.title"
        placeholder='{{ i18n "pages.settings.bugReport.titlePlaceholder" }}'
        :maxLength="500"
      ></a-input>
    </a-form-item>

    <a-form-item label='{{ i18n "pages.settings.bugReport.descriptionLabel" }}' :required="true">
      <a-textarea
        v-model.trim="bugReportData.description"
        placeholder='{{ i18n "pages.settings.bugReport.descriptionPlaceholder" }}'
        :rows="6"
        :maxLength="5000"
      ></a-textarea>
    </a-form-item>

    <a-row :gutter="16">
      <a-col :xs="24" :sm="12">
        <a-form-item label='{{ i18n "pages.settings.bugReport.platformLabel" }}' :required="true">
          <a-select
            v-model="bugReportData.platform"
            placeholder='{{ i18n "pages.settings.bugReport.platformPlaceholder" }}'
            :dropdown-class-name="themeSwitcher.currentTheme"
          >
            <a-select-option value="windows">Windows</a-select-option>
            <a-select-option value="linux">Linux</a-select-option>
            <a-select-option value="macos">macOS</a-select-option>
            <a-select-option value="android">Android</a-select-option>
            <a-select-option value="ios">iOS</a-select-option>
            <a-select-option value="other">Other</a-select-option>
          </a-select>
        </a-form-item>
      </a-col>
      <a-col :xs="24" :sm="12">
        <a-form-item label='{{ i18n "pages.settings.bugReport.appVersionLabel" }}' :required="true">
          <a-input
            v-model.trim="bugReportData.app_version"
            placeholder='{{ i18n "pages.settings.bugReport.appVersionPlaceholder" }}'
          ></a-input>
        </a-form-item>
      </a-col>
    </a-row>

    <a-form-item label='{{ i18n "pages.settings.bugReport.logsLabel" }}'>
      <a-textarea
        v-model.trim="bugReportData.logs"
        placeholder='{{ i18n "pages.settings.bugReport.logsPlaceholder" }}'
        :rows="4"
        :maxLength="10000"
      ></a-textarea>
    </a-form-item>

    <a-form-item label='{{ i18n "pages.settings.bugReport.attachmentsLabel" }}'>
      <a-upload
        :file-list="bugReportFileList"
        :before-upload="beforeUploadFile"
        :remove="handleRemoveFile"
        :multiple="true"
        accept=".jpg,.jpeg,.png,.gif,.pdf,.txt,.log,.zip,.rar,.7z"
      >
        <a-button icon="upload">
          {{ i18n "pages.settings.bugReport.selectFiles" }}
        </a-button>
      </a-upload>
      <div :style="{ marginTop: '8px', color: '#999', fontSize: '12px' }">
        {{ i18n "pages.settings.bugReport.attachmentsHint" }}
      </div>
    </a-form-item>

    <a-form-item>
      <a-button type="primary" html-type="submit" icon="send" :loading="bugReportSubmitting" :disabled="bugReportSubmitting">
        {{ i18n "pages.settings.bugReport.submit" }}
      </a-button>
      <a-button :style="{ marginLeft: '8px' }" @click="resetBugReportForm">
        {{ i18n "pages.settings.bugReport.reset" }}
      </a-button>
    </a-form-item>
  </a-form>

  <a-divider>{{ i18n "pages.settings.bugReport.allReports" }}</a-divider>
  
  <!-- Filter -->
  <a-card :bordered="true" :style="{ marginTop: '16px' }">
    <a-space direction="horizontal" :style="{ marginBottom: '16px' }">
      <span>{{ i18n "pages.settings.bugReport.filterByStatus" }}:</span>
      <a-radio-group v-model="bugReportStatusFilter" @change="filterBugReports">
        <a-radio-button value="all">{{ i18n "pages.settings.bugReport.filterAll" }}</a-radio-button>
        <a-radio-button value="open">{{ i18n "pages.settings.bugReport.filterOpen" }}</a-radio-button>
        <a-radio-button value="in_progress">{{ i18n "pages.settings.bugReport.filterInProgress" }}</a-radio-button>
        <a-radio-button value="closed">{{ i18n "pages.settings.bugReport.filterClosed" }}</a-radio-button>
      </a-radio-group>
      <a-button icon="reload" @click="loadBugReports" :loading="loadingBugReports">{{ i18n "refresh" }}</a-button>
    </a-space>
    
    <!-- Reports List -->
    <a-list
      v-if="filteredBugReports && filteredBugReports.length > 0"
      :data-source="filteredBugReports"
      :loading="loadingBugReports"
      item-layout="vertical"
    >
      <template slot="renderItem" slot-scope="item">
        <a-list-item>
          <a-list-item-meta>
            <template slot="title">
              <a-tag color="blue" :style="{ cursor: 'pointer', marginRight: '8px' }" @click="copyToClipboard(item.id)">
                [[ item.id.substring(0, 8) + '...' ]]
              </a-tag>
              <span>[[ item.title ]]</span>
            </template>
            <template slot="description">
              <a-descriptions :column="2" size="small" bordered>
                <a-descriptions-item label='{{ i18n "pages.settings.bugReport.statusLabel" }}'>
                  <a-tag :color="getStatusColor(item.status)">[[ item.status ]]</a-tag>
                </a-descriptions-item>
                <a-descriptions-item label='{{ i18n "pages.settings.bugReport.taigaRef" }}' v-if="item.taiga_task_ref">
                  <a-tag color="green">[[ item.taiga_task_ref ]]</a-tag>
                </a-descriptions-item>
                <a-descriptions-item label='{{ i18n "pages.settings.bugReport.createdAt" }}'>
                  [[ formatDate(item.created_at) ]]
                </a-descriptions-item>
                <a-descriptions-item label='{{ i18n "pages.settings.bugReport.actions" }}'>
                  <a-button size="small" icon="reload" @click="checkSingleBugReportStatus(item.id)" :loading="checkingStatuses[item.id]">
                    {{ i18n "pages.settings.bugReport.checkStatus" }}
                  </a-button>
                </a-descriptions-item>
              </a-descriptions>
            </template>
          </a-list-item-meta>
        </a-list-item>
      </template>
    </a-list>
    <a-empty v-else description="{{ i18n "noData" }}" />
  </a-card>
</a-card>
{{end}}
